@addTagHelper *, FitMeApp
@model FitMeApp.WEB.Contracts.ViewModels.CurrentDayEventsViewModel
@* PartialView (main page - /Schedule/Index) *@

@{
    Layout = null;
}

<div class="container" style="width:100%;border:solid; border-color:lightgray">

    <div class="row">
        <div class="col-md-2" style="text-align:center">
            @{ int previousYear = Model.Year - 1;}
            <form asp-controller="Schedule" asp-action="CalendarCarousel">
                <input type="hidden" asp-for="Year" value="@previousYear" />
                <input type="hidden" asp-for="Month" value="@Model.Month" />
                @foreach (var item in Model.DatesEventsCount)
                {
                    <input type="hidden" asp-for="DatesEventsCount[item.Key]" value="@item.Value" />
                }
                <input type="submit" value="&#60" class="btn btn-light" />
            </form>
        </div>
        <div class="col-md-8" style="text-align:center">
            <div id="currentYear" style="font-size:medium">
                @Model.Year
            </div>
        </div>
        <div class="col-md-2" style="text-align:center">
            @{ int nextYear = Model.Year + 1;}
            <form asp-controller="Schedule" asp-action="CalendarCarousel">
                <input type="hidden" asp-for="Year" value="@nextYear" />
                <input type="hidden" asp-for="Month" value="@Model.Month" />
                @foreach (var item in Model.DatesEventsCount)
                {
                    <input type="hidden" asp-for="DatesEventsCount[item.Key]" value="@item.Value" />
                }
                <input type="submit" value="&#62" class="btn btn-light" />
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2" style="text-align:center">
            @{
                int previousMonth = Model.Month - 1;
                if (previousMonth <= 0)
                {
                    previousMonth = 12;
                    <form asp-controller="Schedule" asp-action="CalendarCarousel">
                        <input type="hidden" asp-for="Year" value="@(Model.Year-1)" />
                        <input type="hidden" asp-for="Month" value="@previousMonth" />
                        @foreach (var item in Model.DatesEventsCount)
                        {
                            <input type="hidden" asp-for="DatesEventsCount[item.Key]" value="@item.Value" />
                        }
                        <input type="submit" value="&#60" class="btn btn-light" />
                    </form>
                }
                else
                {
                    <form asp-controller="Schedule" asp-action="CalendarCarousel">
                        <input type="hidden" asp-for="Year" value="@Model.Year" />
                        <input type="hidden" asp-for="Month" value="@previousMonth" />
                        @foreach (var item in Model.DatesEventsCount)
                        {
                            <input type="hidden" asp-for="DatesEventsCount[item.Key]" value="@item.Value" />
                        }
                        <input type="submit" value="&#60" class="btn btn-light" />
                    </form>
                };
            }

        </div>
        <div class="col-md-8" style="text-align:center">
            <div style="font-size:medium">
                @Model.MonthName
            </div>
        </div>
        <div class="col-md-2" style="text-align:center">
            @{
                int nextMonth = Model.Month + 1;
                if (nextMonth > 12)
                {
                    nextMonth = 1;
                    <form asp-controller="Schedule" asp-action="CalendarCarousel">
                        <input type="hidden" asp-for="Year" value="@(Model.Year+1)" />
                        <input type="hidden" asp-for="Month" value="@nextMonth" />
                        @foreach (var item in Model.DatesEventsCount)
                        {
                            <input type="hidden" asp-for="DatesEventsCount[item.Key]" value="@item.Value" />
                        }
                        <input type="submit" value="&#62" class="btn btn-light" />
                    </form>
                }
                else
                {
                    <form asp-controller="Schedule" asp-action="CalendarCarousel">
                        <input type="hidden" asp-for="Year" value="@Model.Year" />
                        <input type="hidden" asp-for="Month" value="@nextMonth" />
                        @foreach (var item in Model.DatesEventsCount)
                        {
                            <input type="hidden" asp-for="DatesEventsCount[item.Key]" value="@item.Value" />
                        }
                        <input type="submit" value="&#62" class="btn btn-light" />
                    </form>
                };
            }

        </div>
    </div>
    <div class="row">
        <table class="table-sm" style="text-align:center;font-size:small; width:100%">
            <thead>
                <tr>
                    @foreach (var dayName in ViewBag.DaysOfWeek)
                    {
                        <th scope="col" id="@dayName">@dayName</th>
                    }
                </tr>
            </thead>
            <tbody>
                @{string showEvents = "";
                    if (User.IsInRole("trainer"))
                    {
                        showEvents = "ShowTrainersEvents";
                    }
                    else
                    {
                        showEvents = "ShowUsersEvents";
                    }}
                <tr>
                    @{ int firstday = ((int)new DateTime(Model.Year, Model.Month, 1).DayOfWeek);
                        int daysInMonth = DateTime.DaysInMonth(Model.Year, Model.Month);
                        int date = 1;
                    }
                    @for (int i = 0; i < 7; i++)
                    {
                        if (firstday == i)
                        {
                            <td id="1_@i">
                                @{DateTime currentDate = new DateTime(Model.Year, Model.Month, date);}

                                @await Component.InvokeAsync("DateOnCalendar", new { model = Model, dayNumber = date, showEventsActionName = showEvents})

                                <!--<form asp-controller="Schedule" asp-action="@showEvents" method="post">
                                    <input type="hidden" asp-for="Year" value="@Model.Year" />
                                    <input type="hidden" asp-for="Month" value="@Model.Month" />
                                    <input type="hidden" asp-for="Day" value="@date" />
                                    @{ string dayName = new DateTime(Model.Year, Model.Month, date).DayOfWeek.ToString(); }
                                    <input type="hidden" asp-for="DayName" value="@dayName" />
                                    @foreach (var item in Model.DatesEventsCount)
                                    {
                                        <input type="hidden" asp-for="DatesEventsCount[item.Key]" value="@item.Value" />
                                    }
                                    <div class="btn btn-light btn-sm position-relative" style="padding:0px">
                                        <input type="submit" value=" @date" class="btn btn-light btn-sm">
                                        @if (Model.DatesEventsCount.ContainsKey(new DateTime(Model.Year, Model.Month, date)))
                                        {
                                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                                @Model.DatesEventsCount[new DateTime(Model.Year, Model.Month, date)]
                                                <span class="visually-hidden">unread messages</span>
                                            </span>
                                        }

                                    </div>-->





                                    @*<a asp-controller="Schedule" asp-action="@showEvents" asp-route-year="@Model.Year" asp-route-month="@Model.Month" asp-route-day="@date" class="btn btn-light btn-sm position-relative">
                                            @date
                                            @if (Model.DatesEventsCount.ContainsKey(new DateTime(Model.Year, Model.Month, date)))
                                            {
                                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                                    @Model.DatesEventsCount[new DateTime(Model.Year, Model.Month, date)]
                                                    <span class="visually-hidden">unread messages</span>
                                                </span>
                                            }
                                        </a>*@
                                <!--</form>-->

                            </td>
                            ++date;

                            for (int j = i + 1; j < 7; j++)
                            {
                                <td id="1_@j">
                                    <a asp-controller="Schedule" asp-action="@showEvents" asp-route-year="@Model.Year" asp-route-month="@Model.Month" asp-route-day="@date" class="btn btn-light btn-sm position-relative">
                                        @date
                                        @if (Model.DatesEventsCount.ContainsKey(new DateTime(Model.Year, Model.Month, date)))
                                        {
                                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                                @Model.DatesEventsCount[new DateTime(Model.Year, Model.Month, date)]
                                                <span class="visually-hidden">unread messages</span>
                                            </span>
                                        }
                                    </a>
                                </td>
                                ++date;
                            }
                            i = 7;
                        }
                        else
                        {
                            <td id="1_@i"></td>
                        }
                    }
                </tr>

                @for (int j = 2; j < 5; j++)
                {
                    <tr>
                        @for (int i = 0; i < 7; i++)
                        {
                            <td id="@(j)_@i">
                                <a asp-controller="Schedule" asp-action="@showEvents" asp-route-year="@Model.Year" asp-route-month="@Model.Month" asp-route-day="@date" class="btn btn-light btn-sm position-relative">
                                    @date
                                    @if (Model.DatesEventsCount.ContainsKey(new DateTime(Model.Year, Model.Month, date)))
                                    {
                                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                            @Model.DatesEventsCount[new DateTime(Model.Year, Model.Month, date)]
                                            <span class="visually-hidden">unread messages</span>
                                        </span>
                                    }
                                </a>
                            </td>
                            ++date;
                        }
                    </tr>
                }

                <tr>
                    @for (int i = 0; i < 7 && date <= daysInMonth; i++)
                    {
                        <td id="5_@i">
                            <a asp-controller="Schedule" asp-action="@showEvents" asp-route-year="@Model.Year" asp-route-month="@Model.Month" asp-route-day="@date" class="btn btn-light btn-sm position-relative">
                                @date
                                @if (Model.DatesEventsCount.ContainsKey(new DateTime(Model.Year, Model.Month, date)))
                                {
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                        @Model.DatesEventsCount[new DateTime(Model.Year, Model.Month, date)]
                                        <span class="visually-hidden">unread messages</span>
                                    </span>
                                }
                            </a>
                        </td>
                        ++date;
                    }
                </tr>
                <tr>
                    @for (int i = 0; date <= daysInMonth; i++)
                    {
                        <td id="6_@i">
                            <a asp-controller="Schedule" asp-action="@showEvents" asp-route-year="@Model.Year" asp-route-month="@Model.Month]" asp-route-day="@date" class="btn btn-light btn-sm position-relative">
                                @date
                                @if (Model.DatesEventsCount.ContainsKey(new DateTime(Model.Year, Model.Month, date)))
                                {
                                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                        @Model.DatesEventsCount[new DateTime(Model.Year, Model.Month, date)]
                                        <span class="visually-hidden">unread messages</span>
                                    </span>
                                }
                            </a>
                        </td>
                        ++date;
                    }
                </tr>
            </tbody>
        </table>
    </div>
</div>







